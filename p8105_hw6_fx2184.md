p8105_hw6_fx2184
================
Fei
2022-12-03

## Problem 2 Washingtong Post - Homicides

``` r
#import the dataset 
url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"
homicides_raw = read_csv(url)
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# create variable city_state and clean the dataset
homicides = homicides_raw %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, state,sep = ", "),
         victim_age = as.numeric(victim_age),
         victim_race = fct_relevel(victim_race, "White"),
         resolved = case_when(
           disposition == "Closed by arrest" ~ 1,
           disposition ==  "Open/No arrest" ~ 0,
           disposition ==  "Closed without arrest" ~ 0
         ),
         reported_date = as.Date(as.character(reported_date), format = "%Y%m%d")) %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO","Tulsa, AL")))%>% 
  filter(victim_race  %in% c("White", "Black"))
```

``` r
## generate glm model, let binary variable resolved as outcome, and age, sex and race as predictors. 
Baltimoe_fit_logistic = homicides %>% 
    filter(city_state  %in% c("Baltimore, MD")) %>% 
    glm(resolved ~ victim_age + victim_sex +victim_race, data = ., family = binomial()) 

## Table below summaries the coefficients from the model fit
Baltimoe_fit_logistic%>% 
  broom::tidy(conf.int = T) %>% 
  mutate(OR = exp(estimate),
         CI_Lower = exp(conf.low),
         CI_Upper = exp(conf.high)) %>%
  select(term, log_OR = estimate, OR, CI_Lower, CI_Upper, p.value) %>% 
  knitr::kable(align = "lrr",
               col.names = c("Term","Estimate","OR", "95% CI Lower", "95% CI Upper", "P-value"),
               digits = 3)
```

| Term             | Estimate |    OR | 95% CI Lower | 95% CI Upper | P-value |
|:-----------------|---------:|------:|:-------------|-------------:|--------:|
| (Intercept)      |    1.152 | 3.164 | 1.998        |        5.057 |   0.000 |
| victim_age       |   -0.007 | 0.993 | 0.987        |        1.000 |   0.043 |
| victim_sexMale   |   -0.854 | 0.426 | 0.324        |        0.558 |   0.000 |
| victim_raceBlack |   -0.842 | 0.431 | 0.305        |        0.606 |   0.000 |

-   In Baltimore, MD. Homicides in which the victim is Black are
    substantially less likely to be resolved that those in which the
    victim is white.
-   In Baltimore, MD. Homicides in which the victim is male are
    significantly less like to be resolved than those in which the
    victim is female.
-   The effect of age is statistically significant, but careful data
    inspections should be conducted before interpreting too deeply.

``` r
# glm for each of the cities in your dataset, and extract the adjusted odds ratio (and CI) for solving homicides 
allcities_logistic = homicides %>% 
  nest(data = -city_state) %>% 
  mutate(
    models = map(data, ~glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())),
    results = map(models, ~broom::tidy(.x, conf.int = T))) %>% 
  select(-data, -models) %>% 
  unnest(results) %>% 
  mutate(term = fct_inorder(term),
         OR = exp(estimate),
         CI_Lower = exp(conf.low),
         CI_Upper = exp(conf.high)) %>% 
  filter(term == "victim_sexMale") %>% 
  select(city_state,term, log_OR = estimate, OR, CI_Lower, CI_Upper, p.value)

allcities_logistic %>% 
  knitr::kable(align = "lrr",
               col.names = c("City_State","Term","Estimate","OR", "95% CI Lower", "95% CI Upper", "P-value"),
               digits = 3)
```

| City_State         |           Term | Estimate | OR    | 95% CI Lower | 95% CI Upper | P-value |
|:-------------------|---------------:|---------:|:------|-------------:|-------------:|:--------|
| Albuquerque, NM    | victim_sexMale |    0.570 | 1.767 |        0.825 |        3.762 | 0.139   |
| Atlanta, GA        | victim_sexMale |    0.000 | 1.000 |        0.680 |        1.458 | 1.000   |
| Baltimore, MD      | victim_sexMale |   -0.854 | 0.426 |        0.324 |        0.558 | 0.000   |
| Baton Rouge, LA    | victim_sexMale |   -0.964 | 0.381 |        0.204 |        0.684 | 0.002   |
| Birmingham, AL     | victim_sexMale |   -0.139 | 0.870 |        0.571 |        1.314 | 0.511   |
| Boston, MA         | victim_sexMale |   -0.395 | 0.674 |        0.353 |        1.277 | 0.226   |
| Buffalo, NY        | victim_sexMale |   -0.653 | 0.521 |        0.288 |        0.936 | 0.029   |
| Charlotte, NC      | victim_sexMale |   -0.123 | 0.884 |        0.551 |        1.391 | 0.600   |
| Chicago, IL        | victim_sexMale |   -0.891 | 0.410 |        0.336 |        0.501 | 0.000   |
| Cincinnati, OH     | victim_sexMale |   -0.917 | 0.400 |        0.231 |        0.667 | 0.001   |
| Columbus, OH       | victim_sexMale |   -0.630 | 0.532 |        0.377 |        0.748 | 0.000   |
| Denver, CO         | victim_sexMale |   -0.736 | 0.479 |        0.233 |        0.962 | 0.041   |
| Detroit, MI        | victim_sexMale |   -0.541 | 0.582 |        0.462 |        0.734 | 0.000   |
| Durham, NC         | victim_sexMale |   -0.208 | 0.812 |        0.382 |        1.658 | 0.576   |
| Fort Worth, TX     | victim_sexMale |   -0.402 | 0.669 |        0.394 |        1.121 | 0.131   |
| Fresno, CA         | victim_sexMale |    0.289 | 1.335 |        0.567 |        3.048 | 0.496   |
| Houston, TX        | victim_sexMale |   -0.341 | 0.711 |        0.557 |        0.906 | 0.006   |
| Indianapolis, IN   | victim_sexMale |   -0.085 | 0.919 |        0.678 |        1.241 | 0.582   |
| Jacksonville, FL   | victim_sexMale |   -0.329 | 0.720 |        0.536 |        0.965 | 0.028   |
| Las Vegas, NV      | victim_sexMale |   -0.178 | 0.837 |        0.606 |        1.151 | 0.278   |
| Long Beach, CA     | victim_sexMale |   -0.891 | 0.410 |        0.143 |        1.024 | 0.072   |
| Los Angeles, CA    | victim_sexMale |   -0.413 | 0.662 |        0.457 |        0.954 | 0.028   |
| Louisville, KY     | victim_sexMale |   -0.712 | 0.491 |        0.301 |        0.784 | 0.003   |
| Memphis, TN        | victim_sexMale |   -0.324 | 0.723 |        0.526 |        0.984 | 0.042   |
| Miami, FL          | victim_sexMale |   -0.663 | 0.515 |        0.304 |        0.873 | 0.013   |
| Milwaukee, wI      | victim_sexMale |   -0.319 | 0.727 |        0.495 |        1.054 | 0.098   |
| Minneapolis, MN    | victim_sexMale |   -0.054 | 0.947 |        0.476 |        1.881 | 0.876   |
| Nashville, TN      | victim_sexMale |    0.034 | 1.034 |        0.681 |        1.556 | 0.873   |
| New Orleans, LA    | victim_sexMale |   -0.536 | 0.585 |        0.422 |        0.812 | 0.001   |
| New York, NY       | victim_sexMale |   -1.338 | 0.262 |        0.133 |        0.485 | 0.000   |
| Oakland, CA        | victim_sexMale |   -0.574 | 0.563 |        0.364 |        0.867 | 0.009   |
| Oklahoma City, OK  | victim_sexMale |   -0.026 | 0.974 |        0.623 |        1.520 | 0.908   |
| Omaha, NE          | victim_sexMale |   -0.961 | 0.382 |        0.199 |        0.711 | 0.003   |
| Philadelphia, PA   | victim_sexMale |   -0.701 | 0.496 |        0.376 |        0.650 | 0.000   |
| Pittsburgh, PA     | victim_sexMale |   -0.842 | 0.431 |        0.263 |        0.696 | 0.001   |
| Richmond, VA       | victim_sexMale |    0.006 | 1.006 |        0.483 |        1.994 | 0.987   |
| San Antonio, TX    | victim_sexMale |   -0.350 | 0.705 |        0.393 |        1.238 | 0.230   |
| Sacramento, CA     | victim_sexMale |   -0.402 | 0.669 |        0.326 |        1.314 | 0.255   |
| Savannah, GA       | victim_sexMale |   -0.143 | 0.867 |        0.419 |        1.780 | 0.697   |
| San Bernardino, CA | victim_sexMale |   -0.692 | 0.500 |        0.166 |        1.462 | 0.206   |
| San Diego, CA      | victim_sexMale |   -0.884 | 0.413 |        0.191 |        0.830 | 0.017   |
| San Francisco, CA  | victim_sexMale |   -0.498 | 0.608 |        0.312 |        1.155 | 0.134   |
| St. Louis, MO      | victim_sexMale |   -0.352 | 0.703 |        0.530 |        0.932 | 0.014   |
| Stockton, CA       | victim_sexMale |    0.301 | 1.352 |        0.626 |        2.994 | 0.447   |
| Tampa, FL          | victim_sexMale |   -0.214 | 0.808 |        0.340 |        1.860 | 0.619   |
| Tulsa, OK          | victim_sexMale |   -0.025 | 0.976 |        0.609 |        1.544 | 0.917   |
| Washington, DC     | victim_sexMale |   -0.371 | 0.690 |        0.465 |        1.012 | 0.061   |
